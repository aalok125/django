{% extends 'front/master.html' %}

{% block stylesheet %}
{% endblock %}

{% block contents %}
{% load static %}	
	<div class="banner">
		<div class="banner-content container">
			<div class="recent-searches">
                <div class="trend-search">
                    Trending Searches:
                </div>
				<ul>
					<li>
						<a href=""><i class="fa fa-futbol"></i> Sports</a>
					</li>
					<li>
						<a href=""><i class="fa fa-video"></i> Movies</a>
					</li>
					<li>
						<a href=""><i class="fa fa-music"></i> Songs</a>
					</li>
					<li>
						<a href=""><i class="fa fa-user"></i> Actors</a>
					</li>

				</ul>
			</div>
			<form action="">
				<div class="form-group search">
					<input
                        type="text"
                        id="dynamic_search"
						placeholder="Search for your interested topic"
						class="form-control"
					/>
				</div>
				<div class="form-group search-btn">
					<button type="submit"><i class="fa fa-search"></i> <span class="d-none d-md-inline-block">Search</span></button>
				</div>
			</form>
			<div class="banner-info">
				Info About the company that would give idea about what the site is
				about.
			</div>
		</div>
		<div class="down-button">
			<i class="fa fa-arrow-down"></i>
		</div>
	</div>
	<div class="category-section">
		<div class="container" id="cataccordion">
			<div class="right-arrow">
				<i class="fa fa-arrow-right"></i>
			</div>
			<div class="category-nav nav-pills">

				{% for category in categories %}
					<li class="nav-item">
						<a
							class="nav-link {% if category.active %}active{% endif %}"
							data-toggle="show"
							data-parent="#cataccordion"
							data-target="#tab{{category.id}}"
						>
							<i class="{{category.icon}}"></i>{{ category.title }}</a
						>
					</li>
				{% endfor %}
			</div>

			<!-- Tab panes -->
			<div class="category-content">
				{% for category in categories %}
					<div class="panel-collapse collapse {% if category.active %}in{% endif %}" id="tab{{category.id}}">
						<div class="cat-display-container">
							<div class="row">
								{% if category.children %}
								{% for child in category.children %}
								<div class="col-md-3 col-6">
									<a href="{% url 'category_questions' parent_cat=category.slug child_cat=child.slug %}">
										<div class="cat-item">
											<div class="img-container">
												<img
													src="{% if child.image %} {{child.image.url}} {% endif %}"
													class="img-fluid"
													alt=""
												/>
											</div>
											<div class="cat-title">
												{{child.title}}
											</div>
										</div>
									</a>
								</div>
								{% endfor %}
								{% endif %}
							</div>
						</div>
					</div>
				{% endfor %}

			</div>
		</div>
    </div>
    <div class="trending-question">
        <div class="container">
            <div class="trending-subtitle">
                Most Trending Voting Question
            </div>



            <div class="trending-content">
                <div class="trending-question-item">
                    <div class="trending-title">
                        <h2>{{trending_question.title}}</h2>
                    </div>
                    <div class="row">
                        {% with answers=trending_question.answers %}
                        {% if answers.count > 0 %}
                        {% for answer in answers %}
                            <div class="col-md-3 col-6">
                                <div class="question-item">
                                    <div class="img-container">
                                        <img src="{% if answer.image %} {{answer.image.url}} {% endif %}" class="img-fluid" alt="">
                                    </div>
                                    <div class="name">{{answer.title}}</div>
                                    <a href="" class="vote">
                                        <i class="fa fa-thumbs-up"></i>
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                        {% else %}
                            <div class="col-md-6-m-3 col-12">
                                <h4>This poll has no options</h4>
                            </div>
                        {% endif %}
                        {% endwith %}
                    </div>
                    <div class="more-btn">
                        <a href="{% url 'poll' trending_question.slug %}" class="btn btn-primary">Show More Choices</a>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="blog-section">
        <div class="container">
            <div class="blog-title">
                Latest Blogs
            </div>
            <div class="blog-container">
                <div class="row">
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-12">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/cricket.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/basketball.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/basketball.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-12">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/cricket.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-12">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/volleyball.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-12">
                                <a href="" class="blog-item">
                                    <div class="img-container">
                                        <img src="{% static 'front/images/basketball.jpg' %}" alt="" class="img-fluid">
                                        <div class="img-overylay">
                                                <div class="overlay-text">
                                                    <div class="title">
                                                        Messi Scores 6 goals in a Single Game
                                                    </div>
                                                    <div class="subtitle">
                                                        2020-06-06
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascript %}

    <script>

        var typingTimer;                //timer identifier
        var doneTypingInterval = 1500;  //time in ms (5 seconds)
        var myInput = document.getElementById('dynamic_search');

        //on keyup, start the countdown
        myInput.addEventListener('input', () => {
            if (myInput.value == '') { // check if value changed
                doneTyping()
            }
            clearTimeout(typingTimer);
            if (myInput.value) {
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            }
        });
        

        //user is "finished typing", perform search
        function doneTyping () {
            search = myInput.value ? myInput.value : ""
            $.ajax({
                url: "/filter_category",
                method: 'GET',
                data: {
                    'title':search,
                },
                beforeSend:function(data){
                    $('.dropdown_container').show()
                },
                success: function(data){
                    console.log(data)
                    $('.dropdown_container').hide();
                    $('.dropdown_container').empty();
                    
                    // $.each(data, function(key, value){
                    //     console.log(value)
                    //     var url = ''
                    //     var img = '{{ MEDIA_URL }}'+value.fields.image;
                    //     var preview = jQuery(
                    //     '<div class="col-md-3 col-6">'+
                    //         '<div class="voting-item">'+
                    //         '<div class="img-container">'+
                    //             '<img src="'+img+'" class="img-fluid" alt="" />'+
                    //             '<div class="vote-btn">'+
                    //                 '<a href="'+url+'"><i class="fa fa-thumbs-up"></i> Vote</a>'+
                    //             '</div>'+
                    //         '</div>'+
                    //         '<div class="name">'+
                    //             value.fields.title+
                    //         '</div>'+
                    //         '</div>'+			
                    //     '</div>');

                    //     $('.answer_container').append(preview);
                    // })
                    // if(data.length == 0){
                    //     var preview = jQuery('<h3>No Result Found.</h3>');
                    //     $('.answer_container').append(preview);
                    // }
                },
                error: function(error_data){
                    console.log("error")
                    console.log(error_data)
                }
            })
        }
    </script>

{% endblock %}
